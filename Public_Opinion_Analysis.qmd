---
title: "選舉民意調查資料分析報告"
date: today
author: 趙友誠 H24101060
format:
 pdf:
    include-in-header:
      - text: |
         \usepackage{setspace,relsize}
mainfont: "Microsoft JhengHei UI"
toc: TRUE
---
1. 分析所有候選人的知名度、支持度

2. 請提供3號候選人的競選策略(需在何地、對何人進行拉票)

3. 請建立3號候選人支持率的預測模式

# Brief introduction to the data

This is a complete data with no actual missing value while some might be labeled as missing.
Dimension of the Data : ***1671 samples × 15 columns***

| Variables  | Explanation     |
|:-----------|:----------------|
| V1、V2、V3 | District and Li |
| V4_1\~V4_8 | Popularity      |
| V5         | Support level   |
| V6         | Age             |
| V7         | Education level |
| V8         | Sex             |

```{r}
#| output: FALSE
#| warning: FALSE
library(haven)
library(Hmisc)
pollsav <- read_sav("poll.sav")
write.csv(pollsav, file = "poll.csv", row.names = FALSE)
pollcsv <- read.csv("poll.csv")
```

# Preprocessing

First, we replace 91,95,98,99 by 0 and then converted variables from numeric format to factor one. As the graph shown below, there is no missing value in this data.

```{r}
#| output: false
#| warning: false
pollcsv <- data.frame(
  t(apply(pollcsv,MARGIN = 1, FUN = function(row){
    row[row==99 | row==98 | row==91 | row==95] <- 0
    return(row)
  }))
)
pollcsv[] <- lapply(pollcsv, function(item) return(as.factor(item)))
```

```{r}
DataExplorer::plot_missing(pollcsv)
```

# Descriptive statistic

This chunk is for the convenience of analysis, so it will not be shown here.
```{r}
#| output: false
#| warning: false
latex(describe(pollcsv, "Public Opinion"),file = "", size = "normalsize")
```

The definition of the popularity of a candidate in this analysis is the number of appearance of a candidate that a participant answered in the 4th question. And the definition of the support level of a candidate is the number of appearance of a candidate in 5th question divided by the number of the participants who specifically choose a name in 5th question. That is, participants who did not actually answered the question are removed from the calculation.
```{r}
#| output: asis
count4 <- unlist(lapply(factor(1:10), function(x){
  return(length(unlist(apply(pollcsv[,4:11], MARGIN = 1, function(row) if(x %in% row) return (TRUE)))))
}))
count5 <- unlist(lapply(factor(0:10),function(x){
  return(sum(pollcsv$v5==x))
} ))
p <- data.frame(factor(1:10), popularity=round(count4/1671,3), count4)
s <- data.frame(factor(1:10), `support level`=round(count5[2:11]/sum(count5[2:11]),3), count5[2:11])
p <- p[order(p$popularity, decreasing = TRUE ),]
s <- s[order(s$support.level, decreasing = TRUE ),]
latex(data.table::data.table(cbind(p,s)),title="",file = "", booktabs = TRUE, cgroup = c('Popularity', 'Support level'), colheads = rep(c('candidate', 'rate', 'count'), 2))
```



